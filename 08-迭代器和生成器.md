## 迭代器（Iterators）和生成器（Generators）

许多编程语言已经从使用`for`循环遍历数据过渡，为了使用以编程方式返回集合中下一项的迭代器对象，它要求初始化变量去追踪集合中的位置。迭代器让操作集合数据更加容易，而且ECMAScript 6给JavaScript添加了迭代器。结合新的数组方法和新的集合类型（比如sets和maps），迭代器是高效处理数据的关键，而且你将在语言的许多其他部分找到它们的痕迹。有一个新的`for-of`循环和迭代器一起使用，spread（`...`）操作符也使用迭代器，而且迭代器甚至让异步编程更简单。

这章涵盖迭代器的许多使用，但是首先，要理解迭代器添加到JavaScript背后的历史。

## 循环问题

如果你曾经写过JavaScript，你可能写过像这样的代码：

```js
var colors = ["red", "green", "blue"];

for (var i = 0, len = colors.length; i < len; i++) {
    console.log(colors[i]);
}
```

标准的`for`循环使用`i`变量追踪`colors`数组中的索引。如果`i`不大于数组长度（储存在`len`），每次循环执行，`i`值自增。

然而这个循环不是十分明了，当你嵌套它们而且需要追踪多个变量时，循环就会变得复杂。额外的复杂可能导致错误，而且`for`循环的样板性质会导致自身出现更多的错误，因为类似的代码要在多个地方写。迭代器正是为了解决这个问题。

## 什么是迭代器

迭代器只是拥有具体接口的对象，它是为迭代而设计的。所有的迭代器都有一个`next()`方法，该方法返回一个结果对象。这个结果对象有两个属性：`value`，它是下一个值，以及`done`，它是boolean值，没有值返回时为true。迭代器在集合内维护了一个内部的位置指针，而且每次调用`next()`方法，它返回下一个合适的值。

如果你在返回最后一个值之后调用`next()`，这个方法返回`done`为`true`，而且`value`包含迭代器的返回值。那个返回值不是数据集合的一部分，而是最后一个关联数据，或者如果不存在这样的数据则为`undefined`。迭代器的返回值类似于函数的返回值，它是给调用者传递信息最后的方式。

考虑到这一点，使用ECMAScript 6创建迭代就十分清晰了：

```js
function createIterator(items) {

    var i = 0;

    return {
        next: function() {

            var done = (i >= items.length);
            var value = !done ? items[i++] : undefined;

            return {
                done: done,
                value: value
            };

        }
    };
}

var iterator = createIterator([1, 2, 3]);

console.log(iterator.next());           // "{ value: 1, done: false }"
console.log(iterator.next());           // "{ value: 2, done: false }"
console.log(iterator.next());           // "{ value: 3, done: false }"
console.log(iterator.next());           // "{ value: undefined, done: true }"

// 所有的再次调用
console.log(iterator.next());           // "{ value: undefined, done: true }"
```

`createIterator()`函数返回一个带有`next()`方法的对象。每次调用该方法，`items`数组的下一个值作为`value`返回。当`i`是3时，`done`变为true，而且三元条件操作符设置`value`为`undefined`。这两个结果满足ECMAScript 6中迭代器的特殊的末尾用例，即在遍历最后一个数据之后调用迭代器的`next()`方法。





